<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZapSan • Início</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header><h1>ZapSan</h1></header>
  <div class="container">
    <div class="card">
      <form id="session-form">
        <label for="session_id">Session ID</label>
        <input id="session_id" placeholder="ex.: loja-sante-a1" autocomplete="off" />
        <div class="row" style="margin-top:8px">
          <button type="submit" class="btn" id="btnCreate">Criar sessão</button>
          <button type="button" class="btn secondary" id="btnQR">Ver QR</button>
          <button type="button" class="btn secondary" id="btnChat">Entrar no Chat</button>
        </div>
      </form>
      <p id="status" style="margin-top:8px; font-size:14px; opacity:.85"></p>
    </div>
    <footer>Servidor único com Baileys + REST + Páginas. Edite <code>config/bot.yaml</code> para personalizar o atendente.</footer>
  </div>
  <script>
    const form = document.querySelector('#session-form');
    const input = document.querySelector('#session_id');
    const statusEl = document.getElementById('status');

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = (input?.value || '').trim();
      if (!id) return alert('Informe um session_id');
      statusEl.textContent = 'Criando sessão...';
      try {
        const r = await fetch('/sessions/create', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ session_id: id })
        });
        if (r.ok) {
          location.href = `/qr.html?session_id=${encodeURIComponent(id)}`;
        } else {
          const j = await r.json().catch(()=>({}));
            alert('Erro ao criar sessão: ' + (j.message || j.error || r.status));
            statusEl.textContent = 'Falha ao criar sessão';
        }
      } catch (err) {
        alert('Erro de rede ao criar sessão');
        statusEl.textContent = 'Erro de rede';
      }
    });

    document.getElementById('btnQR')?.addEventListener('click', () => {
      const id = (input?.value || '').trim();
      if (!id) return alert('Informe um session_id');
      location.href = `/qr.html?session_id=${encodeURIComponent(id)}`;
    });

    document.getElementById('btnChat')?.addEventListener('click', () => {
      const id = (input?.value || '').trim();
      if (!id) return alert('Informe um session_id');
      location.href = `/chat.html?session_id=${encodeURIComponent(id)}`;
    });
  </script>
</body>
</html>