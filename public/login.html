<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ZapSan ‚Ä¢ Login</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' fill='none' stroke='%2369e4a6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M4 12c4-6 12-6 16 0-4 6-12 6-16 0Z'/%3E%3C/svg%3E"/>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    /* Layout responsivo dedicado ao login */
    body { min-height:100dvh; display:flex; flex-direction:column; background:var(--wa-bg); }
    .login-wrapper { flex:1; display:flex; flex-direction:column; justify-content:center; padding:clamp(20px,5vh,48px) clamp(16px,4vw,32px); }
  .login-card { width:100%; max-width:400px; margin:0 auto; position:relative; animation:cardIn .5s ease; }
  .pass-wrap{position:relative;display:flex;align-items:center}
  .toggle-pass{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:transparent;border:0;color:var(--muted);cursor:pointer;font-size:12px;padding:4px}
  .toggle-pass:focus-visible{outline:2px solid var(--wa-accent);border-radius:6px}
  .theme-toggle{position:absolute;top:10px;right:12px;background:transparent;border:0;color:var(--muted);cursor:pointer;font-size:18px;line-height:1;opacity:.7;transition:opacity .2s,transform .2s}
  .theme-toggle:hover,.theme-toggle:focus-visible{opacity:1;transform:scale(1.06)}
  .tab-btn{flex:1;background:var(--wa-panel);border:1px solid var(--wa-border);padding:8px 10px;border-radius:8px;font-size:12px;cursor:pointer;color:var(--muted);transition:.2s}
  .tab-btn[aria-selected="true"]{background:var(--wa-accent);color:#041e11;border-color:var(--wa-accent);font-weight:600}
  .tab-btn:focus-visible{outline:2px solid var(--wa-accent); outline-offset:2px}
  @keyframes cardIn {from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
  .login-card form .input{max-width:100%; box-sizing:border-box;}
  .login-card form .field{width:100%;}
  .login-card .field input.input{width:100%;}
  .brand-logo { display:none; }
    form { display:flex; flex-direction:column; gap:16px; margin-top:12px; }
    .field { display:flex; flex-direction:column; gap:6px; }
    .field label { margin:0; font-size:12px; text-transform:uppercase; letter-spacing:.04em; font-weight:600; color:var(--muted); }
    .field.inline { flex-direction:row; align-items:center; gap:8px; }
    .muted-link { font-size:12px; text-align:right; margin-top:2px; }
    .muted-link a { color:var(--muted); }
    .muted-link a:hover { color:var(--wa-accent); }
    .error-box { display:none; background:#301b1b; border:1px solid #5e2727; color:#fca5a5; padding:10px 12px; border-radius:10px; font-size:12px; line-height:1.3; }
    .error-box.show { display:block; animation:fadeIn .3s ease; }
    .help-text { font-size:12px; color:var(--muted); margin-top:-4px; }
    .btn[disabled] { opacity:.6; cursor:not-allowed; }
    .footer-note { margin-top:32px; text-align:center; font-size:11px; color:var(--muted); opacity:.65; }
    @media (min-width:580px){ .brand-logo{ font-size:22px; } }
    @media (max-width:420px){
      .login-card { padding:4px 0; }
      .brand-logo{ font-size:18px; }
    }
    @media (prefers-reduced-motion:no-preference){
      @keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
    }
    /* High-contrast focus rings explicit */
    .input:focus-visible, button:focus-visible { outline:2px solid var(--wa-accent); outline-offset:2px; }
  </style>
</head>
<body>
  <header class="topbar"><div class="topbar-inner" style="justify-content:center;gap:8px;font-weight:600;">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4 12c4-6 12-6 16 0-4 6-12 6-16 0Z" stroke="currentColor" stroke-width="2"/></svg>
    <span>ZapSan</span>
  </div></header>
  <main class="login-wrapper">
    <div class="card login-card" aria-labelledby="login-title">
  <div style="display:flex;gap:8px;justify-content:center;margin-bottom:12px;" role="tablist">
    <button type="button" class="tab-btn" id="tab-login" role="tab" aria-selected="true">Entrar</button>
    <button type="button" class="tab-btn" id="tab-register" role="tab" aria-selected="false">Criar conta</button>
  </div>
  <p id="login-title" style="margin:0 0 14px; font-size:13px; opacity:.82; text-align:center">Acesse o console para gerenciar sua sess√£o WhatsApp.</p>
      <div class="error-box" id="err-box" role="alert"></div>
      <form id="login-form" autocomplete="on" data-mode="login">
        <div class="field">
          <label for="name">Nome</label>
          <input id="name" type="text" placeholder="Seu nome" autocomplete="name" class="input" />
        </div>
        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="voce@empresa.com" autocomplete="email" class="input" required />
          <div class="help-text" id="email-help">Use seu email corporativo.</div>
        </div>
        <div class="field">
          <label for="password">Senha</label>
          <div class="pass-wrap">
            <input id="password" type="password" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="input" required aria-describedby="pass-help" />
            <button type="button" class="toggle-pass" id="btn-pass" aria-label="Mostrar senha">üëÅ</button>
          </div>
          <div class="help-text" id="pass-help">M√≠nimo 4 caracteres (mock).</div>
        </div>
        <div class="field" id="confirm-wrap" style="display:none;">
          <label for="password2">Confirmar senha</label>
          <div class="pass-wrap">
            <input id="password2" type="password" placeholder="Repetir senha" class="input" aria-describedby="confirm-help" />
          </div>
          <div class="help-text" id="confirm-help">Repita a senha para confirmar.</div>
        </div>
        <!-- Campos de workspace e captcha removidos -->
        <div class="field inline">
          <input type="checkbox" id="remember" style="width:auto;" />
          <label for="remember" style="margin:0;font-size:12px;cursor:pointer;">Lembrar-me</label>
        </div>
  <button class="btn" id="btn-login" type="submit">Entrar</button>
        <div class="muted-link"><a href="#" onclick="alert('Recupera√ß√£o de senha em breve');return false;">Esqueci a senha</a></div>
      </form>
  <div class="footer-note">ZapSan ‚Ä¢ Vers√£o demonstrativa ‚Ä¢ Credenciais n√£o persistem</div>
    </div>
  </main>
  <script>
    (function(){
  const form = document.getElementById('login-form');
  const email = document.getElementById('email');
  const pass = document.getElementById('password');
  const pass2 = document.getElementById('password2');
  const remember = document.getElementById('remember');
  const errBox = document.getElementById('err-box');
  const btn = document.getElementById('btn-login');
  const passToggle = document.getElementById('btn-pass');
  const confirmWrap = document.getElementById('confirm-wrap');
  const tabLogin = document.getElementById('tab-login');
  const tabRegister = document.getElementById('tab-register');
    // Tema toggle √≠cone (persist√™ncia simples)
    const themeBtn = document.createElement('button');
    themeBtn.className='theme-toggle';
    themeBtn.type='button';
    themeBtn.setAttribute('aria-label','Alternar tema');
    document.body.appendChild(themeBtn);
    function applyTheme(t){ document.documentElement.dataset.theme = t; localStorage.setItem('theme',t);} 
    const savedTheme = localStorage.getItem('theme') || 'dark';
    applyTheme(savedTheme);
    function updateThemeIcon(){ themeBtn.textContent = document.documentElement.dataset.theme==='light' ? 'üåô' : '‚òÄÔ∏è'; }
    updateThemeIcon();
    themeBtn.onclick=()=>{ applyTheme(document.documentElement.dataset.theme==='light'?'dark':'light'); updateThemeIcon(); };

      // Toggle senha
      passToggle?.addEventListener('click', ()=>{
        if(pass.type==='password'){ pass.type='text'; passToggle.textContent='üôà'; passToggle.setAttribute('aria-label','Ocultar senha'); }
        else { pass.type='password'; passToggle.textContent='üëÅ'; passToggle.setAttribute('aria-label','Mostrar senha'); }
      });

      // Captcha removido

      function showErr(msg){ if(!errBox)return; errBox.textContent=msg; errBox.classList.add('show'); }
      function clearErr(){ if(!errBox)return; errBox.classList.remove('show'); errBox.textContent=''; }
      function setLoading(v){ if(!btn)return; btn.disabled=v; btn.textContent = v? 'Entrando‚Ä¶':'Entrar'; }
      function setMode(mode){
        form.setAttribute('data-mode', mode);
        const isReg = mode==='register';
        confirmWrap.style.display = isReg ? 'block' : 'none';
        tabLogin.setAttribute('aria-selected', String(!isReg));
        tabRegister.setAttribute('aria-selected', String(isReg));
        btn.textContent = isReg ? 'Criar conta' : 'Entrar';
      }
      tabLogin?.addEventListener('click', ()=> setMode('login'));
      tabRegister?.addEventListener('click', ()=> setMode('register'));

      form?.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const mode = form.getAttribute('data-mode')||'login';
        const em=(email.value||'').trim();
        const pw=(pass.value||'').trim();
        const pwc=(pass2?.value||'').trim();
        clearErr();
        if(!em||!pw){ showErr('Preencha os campos obrigat√≥rios.'); return; }
        if(pw.length < 4){ showErr('Senha m√≠nima de 4 caracteres.'); return; }
        if(mode==='register'){
          if(!pwc){ showErr('Confirme a senha.'); return; }
            if(pw !== pwc){ showErr('As senhas n√£o coincidem.'); return; }
        }
        try {
          setLoading(true);
          const nameEl = document.getElementById('name')
          const name = nameEl && nameEl.value ? nameEl.value.trim() : ''
          const payload = { email: em, password: pw }
          if(name) payload.name = name
          let endpoint = '/auth/login'
          if(mode==='register'){ endpoint = '/auth/register'; payload.confirm = pwc }
          const r = await fetch(endpoint, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) })
          if(!r.ok){ const j=await r.json().catch(()=>({})); showErr('Falha '+(mode==='register'?'registro':'login')+': '+(j.error||r.status)); setLoading(false); return }
          const j = await r.json();
          localStorage.setItem('auth','ok');
          localStorage.setItem('sessionId', j.sessionId);
          localStorage.setItem('userId', j.userId);
          if(remember?.checked) localStorage.setItem('remember','1');
          location.replace('/');
        } catch(err){ showErr('Erro de rede, tente novamente.'); }
        finally { setLoading(false); }
      });
      try { if (localStorage.getItem('auth') === 'ok') { location.replace('/'); } } catch {}
    })();
  </script>
</body>
</html>
